<%= javascript_pack_tag 'raty', 'data-turbolinks-track': 'reload' %>
<%= javascript_pack_tag 'impression', 'data-turbolinks-track': 'reload' %>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<div class="book_info">
    <div class="book_info_inner">
        <div class="book_img_area">
            <a href="" id="thumbnail"></a>
            <%#= link_to image_tag('book_img.svg', alt:'本の画像', class:'book_img'), bookinfo_path, class: 'button' %>
        </div>
        <input type="hidden" id="isbn" value="<%= @book.isbn %>">
        <table>
            <tr>
                <th>タイトル</th>
                <td id="title"></td>
            </tr>
            <tr>
                <th>登録日</th>
                <td><%= @book.created_at.strftime('%Y/%-m/%-d') %></td>
            </tr>
            <tr>
                <th>
                    <%= form_with(model: @book, url:book_show_reading_date_path) do |f| %>
                        <%= f.hidden_field :calendar, value: 'reading_start_date' %>
                        <input type="hidden" name="book_id" value="<%= @book.id %> "/>
                        <%= f.submit '読始め' %>
                    <% end %>
                </th>
                <td id="reading_start_date">
                    <% if @book.reading_start_date %>
                        <%= @book.reading_start_date.strftime('%Y/%-m/%-d') %>
                    <% end %>
                </td>
            </tr>
            <tr>
                <th>
                    <%= form_with(model: @book, url:book_show_reading_date_path) do |f| %>
                        <%= f.hidden_field :calendar, value: 'reading_end_date' %>
                        <input type="hidden" name="book_id" value="<%= @book.id %> "/>
                        <%= f.submit '読了日' %>
                    <% end %>
                </th>
                <td id="reading_end_date">
                    <% if @book.reading_end_date %>
                        <%= @book.reading_end_date.strftime('%Y/%-m/%-d') %>
                    <% end %>
                </td>
            </tr>
            <tr>
                <th>評価</th>
                <td id="evaluation">
                    <% if @book.evaluation == nil%>
                        まだ評価していません。
                    <% end %>
                </td>
            </tr>
        </table>
    </div>
    <% if @book.user_id == current_user.id %>
        <div>
            <%= form_with(model: @impression, url:impression_add_impression_field_path) do |f| %>
                <%= f.hidden_field :id, value: @book.id %>
                <%= f.submit '感想を書く', id: 'submit_btn' %>
            <% end %>
        </div>
        <div id="impression">
        </div>
        <div>
            <p>つぶやく</p>
        </div>
        <% @impressions.each do |impression| %>
            <p id="impression_<%= impression.id %>">
                <%= impression.impression %>
            </p>
            <p><%= impression.updated_at.strftime('%Y/%-m/%-d') %></p>
        <% end %>

</div>
<div>
    <p>感想</p>
    <p>画像</p>
</div>
    <% end %>

<script>
$(document).on('turbolinks:load', function() {
    const isbn = $("#isbn").val();
    const url = "https://api.openbd.jp/v1/get?isbn=" + isbn;
    $.getJSON(url, function(data) {
        if (data[0] == null) {
        } else {
            if (data[0].summary.cover == "") {
                $("#thumbnail").html('<img src=\"/assets/images/book_img.svg\" />');
            } else {
                $("#thumbnail").html('<img src=\"' + data[0].summary.cover + '\" style=\"border:solid 1px #000000\" />');
            }
            $("#title").text(data[0].summary.title);
        }
    });
});
<% if @book.evaluation %> // 評価されていないときは星を表示しない
    $('#evaluation').raty({
        size    : 36,
        starOff : '<%= asset_path('star-off.png') %>',
        starOn  : '<%= asset_path('star-on.png') %>',
        // starHalf: '<%#= asset_path('star-half.png') %>',
        score   : '<%= @book.evaluation %>',
        readOnly: true
    });
<% end %>
</script>

 

